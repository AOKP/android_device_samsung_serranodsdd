From 32c5151c43d7c175ac281d4bfe28d0e092857294 Mon Sep 17 00:00:00 2001
From: Andrew Sutherland <dr3wsuth3rland@gmail.com>
Date: Mon, 17 Dec 2012 14:43:24 -0600
Subject: [PATCH] RIL: fix signal for legacy gsm devices

our parcels are short causing mLteRssnr to be 0 which  is a valid
value and causes SignalStrength to think we are an LTE device.

implement as oldRil "signalstrengthgsm"

Change-Id: Id1b47dbee6cc875bc2cde2f499f6ba788fa9ccb5
---

diff --git a/src/java/com/android/internal/telephony/RIL.java b/src/java/com/android/internal/telephony/RIL.java
index c951ea2..3474a70 100644
--- a/src/java/com/android/internal/telephony/RIL.java
+++ b/src/java/com/android/internal/telephony/RIL.java
@@ -3625,9 +3625,17 @@
 
     protected Object
     responseSignalStrength(Parcel p) {
-        // Assume this is gsm, but doesn't matter as ServiceStateTracker
-        // sets the proper value.
-        SignalStrength signalStrength = SignalStrength.makeSignalStrengthFromRilParcel(p);
+        SignalStrength signalStrength;
+        if (needsOldRilFeature("signalstrengthgsm")) {
+            int gsmSignal  = p.readInt();
+            int gsmErrRate = p.readInt();
+            signalStrength = new SignalStrength(gsmSignal, gsmErrRate,
+                                                -1, -1, -1, -1, -1, true);
+        } else {
+            // Assume this is gsm, but doesn't matter as ServiceStateTracker
+            // sets the proper value.
+            signalStrength = SignalStrength.makeSignalStrengthFromRilParcel(p);
+        }
         return signalStrength;
     }
 
